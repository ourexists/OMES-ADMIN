<!--
  ~ Copyright (c) 2025. created by ourexists.https://gitee.com/ourexists
  -->

<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>数据表格页面</title>
    <link rel="stylesheet" href="../static/layui/css/layui.css">
    <script src="../static/js/jquery.min.js"></script>
    <script src="../static/layui/layui.js"></script>
    <script src="../static/js/i18n.js"></script>
    <script src="../static/js/global.js"></script>
</head>
<body>
<div class="layui-tab-content" style="padding: 15px;">
    <form class="layui-form layui-row layui-col-space16">
        <div class="layui-col-md8">
            <div class="layui-form-item">
                <div class="layui-inline">
                    <div class="layui-inline" id="timeduration">
                        <div class="layui-input-inline">
                            <input type="text" autocomplete="off" id="startDate" class="layui-input"
                                   lang-i18n="common.starttime">
                        </div>
                        <div class="layui-form-mid">-</div>
                        <div class="layui-input-inline">
                            <input type="text" autocomplete="off" id="endDate" class="layui-input"
                                   lang-i18n="common.endtime">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-btn-container layui-col-xs12">
            <button class="layui-btn" lay-submit lay-filter="ebs-material-search" lang-i18n="common.search">Search
            </button>
            <button type="reset" class="layui-btn layui-btn-primary" lang-i18n="common.clear">Clear</button>
        </div>
    </form>
    <table class="layui-hide" id="tb-ebs-material"></table>
</div>
<script type="text/html" id="material-tool">
    <div class="layui-clear-space">
        <a class="layui-btn layui-btn-xs layui-btn-primary" lay-event="detail">
            <i class="layui-icon layui-icon-eye"></i>
        </a>
    </div>
</script>
<script type="text/html" id="material-toolbar">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm layui-btn-primary" id="rowMode">
            <span>{{= d.lineStyle ? i18np.prop('common.mode.multi') : i18np.prop('common.mode.single') }}</span>
            <i class="layui-icon layui-icon-down layui-font-12"></i>
        </button>
    </div>
</script>

<script th:inline="none">
    var table

    layui.use(function () {
        table = layui.table;
        var form = layui.form;
        var dropdown = layui.dropdown;
        var laydate = layui.laydate;

        laydate.render({
            elem: '#timeduration',
            range: ['#startDate', '#endDate'],
            rangeLinked: true,
            type: 'datetime',
            lang: localStorage.getItem(store.language)
        });


        var default_param = {
            cols: [
                // 第一行表头
                [
                    {field: 'LAY_INDEX', title: 'NO', rowspan: 3, width: 40},
                    {field: 'execTime', title: i18np.prop('common.time'), rowspan: 3, width: 160},
                    {title: i18np.prop('report.datalist.inlet'), colspan: 9, rowspan: 2, align: 'center'},
                    {title: i18np.prop('report.datalist.OD11'), colspan: 9, align: 'center'},
                    {title: i18np.prop('report.datalist.OD12'), colspan: 9, align: 'center'},
                    {title: i18np.prop('report.datalist.OD20'), colspan: 9, align: 'center'},
                    {title: i18np.prop('report.datalist.outlet'), colspan: 7, rowspan: 2, align: 'center'},
                ],
                [
                    // {title: i18np.prop('report.datalist.inlet'), colspan: 17, align: 'center'},
                    // {title: i18np.prop('report.datalist.inletd'), colspan: 10, align: 'center'},
                    {title: i18np.prop('report.datalist.OD11AnaerobicTank'), colspan: 1, align: 'center'},
                    {title: i18np.prop('report.datalist.OD11AerobicTank1'), colspan: 3, align: 'center'},
                    {title: i18np.prop('report.datalist.OD11AnoxicTank'), colspan: 2, align: 'center'},
                    {title: i18np.prop('report.datalist.OD11AerobicTank2'), colspan: 2, align: 'center'},
                    {title: i18np.prop('report.datalist.OD11Secondary'), colspan: 1, align: 'center'},
                    {title: i18np.prop('report.datalist.OD12AnaerobicTank'), colspan: 1, align: 'center'},
                    {title: i18np.prop('report.datalist.OD12AerobicTank1'), colspan: 3, align: 'center'},
                    {title: i18np.prop('report.datalist.OD12AnoxicTank'), colspan: 2, align: 'center'},
                    {title: i18np.prop('report.datalist.OD12AerobicTank2'), colspan: 2, align: 'center'},
                    {title: i18np.prop('report.datalist.OD12Secondary'), colspan: 1, align: 'center'},
                    {title: i18np.prop('report.datalist.OD20AnaerobicTank'), colspan: 1, align: 'center'},
                    {title: i18np.prop('report.datalist.OD20AerobicTank1'), colspan: 3, align: 'center'},
                    {title: i18np.prop('report.datalist.OD20AnoxicTank'), colspan: 2, align: 'center'},
                    {title: i18np.prop('report.datalist.OD20AerobicTank2'), colspan: 2, align: 'center'},
                    {title: i18np.prop('report.datalist.OD20Secondary'), colspan: 1, align: 'center'},
                ],
                [

                    {field: 's107Cod', title: i18np.prop('report.datalist.s107Cod'), width: 140, align: 'center'},
                    {field: 's107InNh3', title: i18np.prop('report.datalist.s107InNh3'), width: 140, align: 'center'},
                    {field: 'inletInTn', title: i18np.prop('report.datalist.inletInTn'), width: 140, align: 'center'},
                    {field: 'inletInTp', title: i18np.prop('report.datalist.inletInTp'), width: 140, align: 'center'},
                    {field: 'wpsinletph', title: i18np.prop('report.datalist.WPSinletph'), width: 140, align: 'center'},
                    {field: 'wpsinletss', title: i18np.prop('report.datalist.WPSinletss'), width: 140, align: 'center'},
                    // {
                    //     field: 'WPSinletflow1',
                    //     title: i18np.prop('report.datalist.WPSinletflow1'),
                    //     width: 140,
                    //     align: 'center'
                    // },
                    // {
                    //     field: 'WPSinletflow2',
                    //     title: i18np.prop('report.datalist.WPSinletflow2'),
                    //     width: 140,
                    //     align: 'center'
                    // },
                    // {
                    //     field: 'WPSinletflow3',
                    //     title: i18np.prop('report.datalist.WPSinletflow3'),
                    //     width: 140,
                    //     align: 'center'
                    // },
                    // {
                    //     field: 'WPSinletflow4',
                    //     title: i18np.prop('report.datalist.WPSinletflow4'),
                    //     width: 140,
                    //     align: 'center'
                    // },
                    // {
                    //     field: 'WPSinletflow5',
                    //     title: i18np.prop('report.datalist.WPSinletflow5'),
                    //     width: 140,
                    //     align: 'center'
                    // },
                    {
                        field: 'wpsinletflowTotal',
                        title: i18np.prop('report.datalist.WPSinletTotal'),
                        width: 140,
                        align: 'center'
                    },
                    // {
                    //     field: 'wpsTotalFlow1',
                    //     title: i18np.prop('report.datalist.wpsTotalFlow1'),
                    //     width: 140,
                    //     align: 'center'
                    // },
                    // {
                    //     field: 'wpsTotalFlow2',
                    //     title: i18np.prop('report.datalist.wpsTotalFlow2'),
                    //     width: 140,
                    //     align: 'center'
                    // },
                    // {
                    //     field: 'wpsTotalFlow3',
                    //     title: i18np.prop('report.datalist.wpsTotalFlow3'),
                    //     width: 140,
                    //     align: 'center'
                    // },
                    // {
                    //     field: 'wpsTotalFlow4',
                    //     title: i18np.prop('report.datalist.wpsTotalFlow4'),
                    //     width: 140,
                    //     align: 'center'
                    // },
                    // {
                    //     field: 'wpsTotalFlow5',
                    //     title: i18np.prop('report.datalist.wpsTotalFlow5'),
                    //     width: 140,
                    //     align: 'center'
                    // },
                    {
                        field: 'wpsTotalFlowTotal',
                        title: i18np.prop('report.datalist.wpsTotalFlowTotal'),
                        width: 140,
                        align: 'center'
                    },
                    {field: 'wpsflow', title: i18np.prop('report.datalist.WPSflow'), width: 140, align: 'center'},
                    // {field: 'wpsCoarseScreen1', title: i18np.prop('report.datalist.wpsCoarseScreen1'), width: 100, align: 'center'},
                    // {field: 'wpsCoarseScreen2', title: i18np.prop('report.datalist.wpsCoarseScreen2'), width: 100, align: 'center'},
                    // {field: 'wpsCoarseScreen3', title: i18np.prop('report.datalist.wpsCoarseScreen3'), width: 100, align: 'center'},
                    // {field: 'wpsCoarseScreen4', title: i18np.prop('report.datalist.wpsCoarseScreen4'), width: 100, align: 'center'},
                    // {field: 'wpsFineGrid1', title: i18np.prop('report.datalist.wpsFineGrid1'), width: 100, align: 'center'},
                    // {field: 'wpsFineGrid2', title: i18np.prop('report.datalist.wpsFineGrid2'), width: 100, align: 'center'},
                    // {field: 'wpsFineGrid3', title: i18np.prop('report.datalist.wpsFineGrid3'), width: 100, align: 'center'},
                    // {field: 'wpsFineGrid4', title: i18np.prop('report.datalist.wpsFineGrid4'), width: 100, align: 'center'},
                    {
                        field: 'od11AnaerobicTankORP',
                        title: i18np.prop('report.datalist.OD11AnaerobicTankORP'),
                        width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od11AerobicTankORP1',
                        title: i18np.prop('report.datalist.OD11AerobicTankORP1'),
                        width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od11AerobicTankDO', title: i18np.prop('report.datalist.OD11AerobicTankDO'), width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od11AerobicTankNitrificationAndAmmonium',
                        title: i18np.prop('report.datalist.OD11AerobicTankNitrificationAndAmmonium'), width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od11AnoxicTankORP',
                        title: i18np.prop('report.datalist.OD11AnoxicTankORP'),
                        width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od11AnoxicTankDO',
                        title: i18np.prop('report.datalist.OD11AnoxicTankDO'),
                        width: 100,
                        align: 'center'
                    },

                    {
                        field: 'od11AerobicTankORP2',
                        title: i18np.prop('report.datalist.OD11AerobicTankORP2'),
                        width: 100, align: 'center'
                    },
                    {
                        field: 'od11SludgeConcentrationInAerobicTank',
                        title: i18np.prop('report.datalist.OD11SludgeConcentrationInAerobicTank'),
                        width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od11SecondaryClarifierSludge',
                        title: i18np.prop('report.datalist.OD11SecondaryClarifierSludge'), width: 100, align: 'center'
                    },

                    {
                        field: 'od12AnaerobicTankORP',
                        title: i18np.prop('report.datalist.OD12AnaerobicTankORP'),
                        width: 100,
                        align: 'center'
                    },

                    {
                        field: 'od12AerobicTankORP1',
                        title: i18np.prop('report.datalist.OD12AerobicTankORP1'),
                        width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od12AerobicTankDO', title: i18np.prop('report.datalist.OD12AerobicTankDO'), width: 100,
                        align: 'center'
                    },

                    {
                        field: 'od12AerobicTankNitrificationAndAmmonium',
                        title: i18np.prop('report.datalist.OD12AerobicTankNitrificationAndAmmonium'),
                        width: 100,
                        align: 'center'
                    },

                    {
                        field: 'od12AnoxicTankORP',
                        title: i18np.prop('report.datalist.OD12AnoxicTankORP'),
                        width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od12AnoxicTankDO',
                        title: i18np.prop('report.datalist.OD12AnoxicTankDO'),
                        width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od12AerobicTankORP2',
                        title: i18np.prop('report.datalist.OD12AerobicTankORP2'),
                        width: 100,
                        align: 'center'
                    },

                    {
                        field: 'od12SludgeConcentrationInAerobicTank',
                        title: i18np.prop('report.datalist.OD12SludgeConcentrationInAerobicTank'), width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od12SecondaryClarifierSludge',
                        title: i18np.prop('report.datalist.OD12SecondaryClarifierSludge'), width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od20AnaerobicTankORP',
                        title: i18np.prop('report.datalist.OD20AnaerobicTankORP'),
                        width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od20AerobicTankORP1',
                        title: i18np.prop('report.datalist.OD20AerobicTankORP1'),
                        width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od20AerobicTankDO',
                        title: i18np.prop('report.datalist.OD20AerobicTankDO'),
                        width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od20AerobicTankNitrificationAndAmmonium',
                        title: i18np.prop('report.datalist.OD20AerobicTankNitrificationAndAmmonium'),
                        width: 100,
                        align: 'center'
                    },

                    {
                        field: 'od20AnoxicTankORP', title: i18np.prop('report.datalist.OD20AnoxicTankORP'),
                        width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od20AnoxicTankDO', title: i18np.prop('report.datalist.OD20AnoxicTankDO'),
                        width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od20AerobicTankORP2', title: i18np.prop('report.datalist.OD20AerobicTankORP2'),
                        width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od20SludgeConcentrationInAerobicTank',
                        title: i18np.prop('report.datalist.OD20SludgeConcentrationInAerobicTank'),
                        width: 100,
                        align: 'center'
                    },
                    {
                        field: 'od20SecondaryClarifierSludge',
                        title: i18np.prop('report.datalist.OD20SecondaryClarifierSludge'),
                        width: 100,
                        align: 'center'
                    },
                    {
                        field: 's108OutCod',
                        title: i18np.prop('report.datalist.s108OutCod'),
                        width: 140,
                        align: 'center'
                    },
                    {
                        field: 's108Nh3',
                        title: i18np.prop('report.datalist.s108Nh3'),
                        width: 140,
                        align: 'center'
                    },
                    {
                        field: 's108OutTn',
                        title: i18np.prop('report.datalist.s108OutTn'),
                        width: 140,
                        align: 'center'
                    },
                    {
                        field: 's108OutTh',
                        title: i18np.prop('report.datalist.s108OutTh'),
                        width: 140,
                        align: 'center'
                    },
                    {
                        field: 's108OutPh',
                        title: i18np.prop('report.datalist.s108OutPh'),
                        width: 140,
                        align: 'center'
                    },
                    {
                        field: 'wpsoutletflow',
                        title: i18np.prop('report.datalist.WPSoutletflow'),
                        width: 140,
                        align: 'center'
                    },
                    {
                        field: 'wpsOutletFlowTotal',
                        title: i18np.prop('report.datalist.wpsOutletFlowTotal'),
                        width: 140,
                        align: 'center'
                    },
                ]],
            toolbar: '#material-toolbar',
            defaultToolbar: ['filter', 'exports'],
        }

        // 创建表格实例
        table.render({
            elem: '#tb-ebs-material',
            data: [],
            toolbar: default_param.toolbar,
            defaultToolbar: default_param.defaultToolbar,
            cols: default_param.cols,
            totalRow: true,
            text: {
                none: i18np.prop('common.msg.selecttime')
            },

            title: "procount_" + layui.util.toDateString((new Date()), "yyyyMMddHHmmss"),
            done: function () {
                // 行模式
                dropdown.render({
                    elem: '#rowMode',
                    data: [{
                        id: 'default-row',
                        title: i18np.prop('common.mode.single')
                    }, {
                        id: 'multi-row',
                        title: i18np.prop('common.mode.multi')
                    }],
                    // 菜单被点击的事件
                    click: function (obj) {
                        switch (obj.id) {
                            case 'default-row':
                                table.reload('tb-ebs-material', {
                                    lineStyle: null // 恢复单行
                                });
                                break;
                            case 'multi-row':
                                table.reload('tb-ebs-material', {
                                    // 设置行样式，此处以设置多行高度为例。若为单行，则没必要设置改参数 - 注：v2.7.0 新增
                                    lineStyle: 'height: 95px;'
                                });
                                break;
                        }
                    }
                });
            },
            request: {
                pageName: 'page',
                limitName: 'pageSize'
            },
            response: {
                statusName: 'code', //规定返回的状态码字段为code
                statusCode: 200, //规定成功的状态码味200
            },
            parseData: function (res) {
                return {
                    "code": res.code,
                    "msg": res.msg,
                    "count": res.pagination.total,
                    "data": res.data,
                };
            },
            limit: 10,
            limits: [10, 20, 50, 100, 5000],
            page: true,
            height: '550px'
        });
        // 工具栏事件
        table.on('toolbar(tb-ebs-material)', function (obj) {
            var id = obj.config.id;
            var checkStatus = table.checkStatus(id);
            switch (obj.event) {
                case 'getCheckData':
                    var data = checkStatus.data;
                    if (data.length === 0) {
                        return layer.msg(i18np.prop('common.msg.least.one'));
                    }
                    layer.alert(layui.util.escape(JSON.stringify(data)));
                    break;
                case 'getData':
                    var getData = table.getData(id);
                    layer.alert(layui.util.escape(JSON.stringify(getData)));
                    break;
            }
        });

        // table 滚动时移除内部弹出的元素
        var tableInst = table.getOptions('tb-ebs-material');
        tableInst.elem.next().find('.layui-table-main').on('scroll', function () {
            dropdown.close('dropdown-table-tool');
        });

        // 搜索提交
        form.on('submit(ebs-material-search)', function (data) {
            if ($('#startDate').val() == null || $('#startDate').val() == ''
                || $('#endDate').val() == null || $('#endDate').val() == '') {
                layer.alert(i18np.prop('common.msg.selecttime'));
                return false;
            }
            reloadMaterialTb();
            return false; // 阻止默认 form 跳转
        });
    })
    ;

    function reloadMaterialTb() {
        table.reloadData('tb-ebs-material', {
            url: initRequestUrl(router.report_datalist_page),
            headers: getCommonHeader(),
            method: 'POST',
            contentType: 'application/json',
            where: {
                startDate: $('#startDate').val(),
                endDate: $('#endDate').val()
            },
        });
    }


</script>
</body>
</html>